<div [class]="viewMode + ' storage'">


  <div class="serendip-loader" *ngIf="!!storageService.loadingText">
    <div class="box">
      <div class="logo-wrapper out-of-the-box">
        <div class="loader"></div>

        <div class="logo">
          <img src="assets/graphics/brand/serendip-fav-2-1.svg" alt="" />
        </div>
      </div>
      <div class="text">
        {{ storageService.loadingText }}
      </div>
    </div>
  </div>

  <section class="browser" *ngIf="!storageService.loadingText">

    <ul class="commands bottom" *ngIf="mode">
      <li *ngIf="mode && mode != 'newFolder' && mode != 'newZip' && mode != 'newName' && !modePathsSelected"
        (click)="storageService.fileManagerSelectedPaths.length > 0 ? selectEvents.emit(storageService.fileManagerSelectedPaths) : null">
        <span>
          انتخاب شد ({{storageService.fileManagerSelectedPaths.length.toString() | rpd}})
        </span>
      </li>

      <li *ngIf="mode && mode === 'newFolder' " (click)="selectEvents.emit([newFolderName])  ">
        <span>
          ساخت فولدر
        </span>
      </li>


      <li *ngIf="mode && mode === 'newZip' " (click)="selectEvents.emit([newZipName])  ">
        <span>
          ساخت ZIP
        </span>
      </li>

      <li *ngIf="mode && mode === 'newName' " (click)="selectEvents.emit([newName])  ">
        <span>
          تغییر نام
        </span>
      </li>



      <li *ngIf="mode && !modePathsSelected" class="pull-left" (click)="selectCancel()">
        <span>
          انصراف
        </span>
      </li>
    </ul>
    <ul class="commands" *ngIf="storageService.fileManagerFolderPath"
      [class.disabled]="storageService.fileManagerFolderPath == '/'">



      <li class="upload" *ngIf="(!mode || mode == 'select') && storageService.fileManagerSelectedPaths?.length == 0">
        <input type="file" multiple (change)="uploadZoneChange($event)" id="upload-zone" />
        <img src="assets/icons/upload.svg" title="آپلود" />
      </li>


      <li [class.spanned]="mode == 'select'" *ngIf="mode == 'select'" (click)="setMode('download')">

        <span>
          فایل و یا فولدر‌های مورد نظر
          را انتخاب کنید
        </span>
      </li>

      <li [class.spanned]="mode == 'download'"
        *ngIf="mode == 'download' ? true : (storageService.fileManagerSelectedPaths?.length > 0 && !mode)"
        (click)="setMode('download')">
        <img src="assets/icons/download.svg" title="دانلود" />
        <span *ngIf="mode == 'download'">
          فایل های مورد نظر برای
          <b>دانلود</b>
          را انتخاب کنید
        </span>
      </li>
      <li [class.spanned]="mode == 'share'"
        *ngIf="mode == 'share' ? true : (storageService.fileManagerSelectedPaths?.length != 0 && !mode)"
        (click)="setMode('share')">
        <img src="assets/icons/share.svg" title="اشتراک گذاری" />
        <span *ngIf="mode == 'share'">
          فایل و یا پوشه های مورد نظر برای
          <b>اشتراک گذاری</b>
          را انتخاب کنید
        </span>
      </li>
      <li [class.spanned]="mode == 'zip'"
        *ngIf="mode == 'zip' ? true : (storageService.fileManagerSelectedPaths?.length > 0 && !mode)"
        (click)="setMode('zip')">
        <div class="icon">ZIP</div>
        <span *ngIf="mode == 'zip'">
          فایل‌های مورد نظر برای
          <b>فشرده‌سازی</b>
          را
          انتخاب کنید
        </span>
      </li>


      <li [class.spanned]="mode == 'rename'"
        *ngIf="mode == 'rename' ? true : (storageService.fileManagerSelectedPaths?.length == 1 && !mode)"
        (click)="setMode('rename')">
        <div *ngIf="mode != 'rename'" class="icon">RENAME</div>
        <span *ngIf="mode == 'rename'">
          فایل یا پوشه مورد نظر برای
          <b>تغییر نام</b>
          را
          انتخاب کنید
        </span>
      </li>


      <li *ngIf="mode == 'newZip'">
        <span>
          نام
          <b>فایل ZIP</b>
          را وارد کنید
        </span>
      </li>
      <li *ngIf="(!mode || mode == 'newFolder') && storageService.fileManagerSelectedPaths?.length == 0"
        (click)="setMode('newFolder')">
        <img src="assets/icons/new-folder-1.svg" title="فولدر جدید" />

        <span *ngIf="mode == 'newFolder'">
          نام
          <b>فولدر جدید</b>
          را وارد کنید
        </span>
      </li>




      <li *ngIf="mode === 'selectFile'" (click)="setMode('share')">
        <span>
          فایل مورد نظر را انتخاب کنید
        </span>
      </li>

      <li class="refresh" (click)="refreshFolder()">
        <img src="assets/icons/refresh.svg" title="به‌روز رسانی" />
      </li>

      <li [class.spanned]="mode == 'delete'"
        *ngIf="(!mode || mode == 'delete') && storageService.fileManagerSelectedPaths.length > 0" [class.trash]="!mode"
        (click)="setMode('delete')">
        <img src="assets/icons/recycle-bin-trash-full.svg" title="حدف" />
        <span *ngIf="mode == 'delete'">
          فایل و یا پوشه های مورد نظر
          را انتخاب کنید
        </span>
      </li>
    </ul>


    <!-- 
    <div *ngIf="objectKeys(toDownload).length > 0" class="title">
      <img src="assets/icons/download.svg" /> فایل‌های در حال دانلود ({{
        objectKeys(toDownload).length || "0" | rpd
      }})
    </div>
    <ul *ngIf="objectKeys(toDownload).length > 0" class="files to-download">
      <li *ngFor="let path of objectKeys(toDownload)" [title]="path">
        <div
          class="progress"
          [style.width]="toDownload[path].percent + '%'"
        ></div>
        <img src="assets/icons/export-3.svg" alt="" />

        <input type="text" readonly [value]="toDownload[path].name" />
        <div class="size">
          {{ readableSize(toDownload[path].size / 1024 / 1024) | rpd }}
          <div class="en">MB</div>
        </div>
      </li>
    </ul> -->
    <!-- 
    <div
      style="font-family: Arial, Helvetica, sans-serif;direction: ltr;text-align: left"
    >
      {{ storageService.fileManagerFolderPath }}
    </div> -->

    <div class="title" *ngIf="!storageService.fileManagerFolderPath">
      <img src="assets/icons/folder-archive-open.svg" /> مدیریت فایل
    </div>
    <div class="title"
      *ngIf="storageService.fileManagerFolderPath && storageService.fileManagerFolderPath != '/' && folders[storageService.fileManagerFolderPath]">
      <img src="assets/icons/folder-archive-open.svg" />
      <ul class="crumbs">
        <li *ngFor="let c of getCrumbs()">
          پوشه {{ c.label }}</li>
      </ul>
      ({{ folders[storageService.fileManagerFolderPath].length || "0" | rpd }})
    </div>

    <ul *ngIf=" !mode || (mode && mode !='newFolder' && mode !='newZip' && mode !='newName' && !modePathsSelected)"
      class="files to-download">

      <li *ngFor="let path of objectKeys(toUpload)">

        <div class="img">
          <img src="assets/icons/upload.svg" class="icon" alt="" />

        </div>

        <div class="progress" [style.width]="toUpload[path].percent + '%'"></div>


        <div class="size">
          {{ readableSize(toUpload[path].size / 1024 / 1024) | rpd }}

          <div class="en">MB</div>
        </div>

        <input type="text" readonly [class]="
          sUtils.text.persianKeyChar.indexOf(toUpload[path].name[0]) != -1
            ? 'fa'
            : 'en'
        " [value]="toUpload[path].name" />

      </li>

      <li *ngIf="storageService.fileManagerFolderPath != '/'">

        <div class="select">
          <div class="select" (click)="selectAllToggle()">

            <img src="assets/icons/tab-1.svg" *ngIf="storageService.fileManagerSelectedPaths?.length == 0" class=" " />

            <img src="assets/icons/tab-4.svg"
              *ngIf="storageService.fileManagerSelectedPaths?.length != folders[storageService.fileManagerFolderPath || '/']?.length"
              class=" " />

            <img src="assets/icons/check-9.svg"
              *ngIf="storageService.fileManagerSelectedPaths?.length == folders[storageService.fileManagerFolderPath || '/']?.length"
              class=" selected" />
          </div>

        </div>

        <input
          (click)="storageService.fileManagerFolderPath = cdBack(storageService.fileManagerFolderPath); refreshFolder()"
          type="text" name="" style="text-align: left" readonly disabled value="بازگشت به فولدر بالایی" id="" />
        <div class="size">&nbsp;</div>

        <div
          (click)="storageService.fileManagerFolderPath = cdBack(storageService.fileManagerFolderPath); refreshFolder()"
          class="img  no-hover">
          <img class="icon" src="assets/icons/arrow-left-back-10.svg" />
        </div>

      </li>
      <li *ngFor="let item of folders[storageService.fileManagerFolderPath || '/']" [title]="item.basename">
        <div *ngIf="item.uploadPercent && item.uploadPercent != 100" class="progress"
          [style.width]="item.uploadPercent + '%'"></div>

        <div class="select" (click)=" clickOnSelect(item) ">

          <img src="assets/icons/tab-1.svg" *ngIf="  storageService.fileManagerSelectedPaths.indexOf(item.path) == -1"
            class=" " />
          <img src="assets/icons/check-9.svg" *ngIf=" storageService.fileManagerSelectedPaths.indexOf(item.path) != -1"
            class=" selected" />
        </div>




        <input type="text" (click)="clickOnItem(item)" readonly [class]="
            sUtils.text.persianKeyChar.indexOf(item.basename[0]) != -1
              ? 'fa'
              : 'en'
          " [value]="item.basename" />




        <div class="size" (click)="clickOnItem(item)" *ngIf="item.isFile">
          <span *ngIf="item.sizeInMB">
            <div class="en">{{ item.ext | uppercase }}</div>
            {{ readableSize(item.sizeInMB) | rpd }}
            <div class="en">MB</div>
          </span>

          <span *ngIf="!item.sizeInMB">
            <div class="en">{{ item.ext | uppercase }}</div>
            {{ readableSize(item.size / 1024) | rpd }}
            <div class="en">KB</div>
          </span>
        </div>

        <div class="size" *ngIf="item.isDirectory">
          <span class=en>
            DIR
          </span>
        </div>

        <div class="img">
          <img *ngIf="item.isFile " [class.icon]="mode"
            [src]="'assets/mimetypes/' + item.mime?.replace('/','-') + '.svg'" />

          <img *ngIf="
                item.isDirectory 
              " [class.icon]="mode" src="assets/icons/folder-archive.svg" />

        </div>

      </li>





    </ul>

    <div class="folder-empty" *ngIf="
        folders[storageService.fileManagerFolderPath || '/'] && folders[storageService.fileManagerFolderPath || '/'].length == 0
      ">
      <span>
        فایلی در این فولدر یافت نشد
      </span>
    </div>

    <div class="form-wrapper" *ngIf="mode == 'newFolder'">
      <app-form-text-input [model]="newFolderName" (modelChange)="newFolderName = $event" [dir]="
              sUtils.text.persianKeyChar.indexOf(newFolderName[0]) != -1
                ? 'rtl'
                : 'ltr'
            " label="نام فولدر جدید"></app-form-text-input>
    </div>


    <div class="form-wrapper" *ngIf="mode == 'newZip'">
      <app-form-text-input [model]="newZipName" (modelChange)="newZipName = $event" [dir]="
              sUtils.text.persianKeyChar.indexOf(newZipName[0]) != -1
                ? 'rtl'
                : 'ltr'
            " label="نام فایل ZIP"></app-form-text-input>
      <div class="hint">
        در صورت خالی گذاشتن فیلد بالا، فایلی با نام تاریخ امروز ساخته خواهد شد.
      </div>
    </div>

    <div class="form-wrapper" *ngIf="mode == 'newName'">
      <app-form-text-input [model]="tempPaths[0].split('/').reverse()[0]" (modelChange)="newName = $event" [dir]="
              sUtils.text.persianKeyChar.indexOf(newName[0]) != -1
                ? 'rtl'
                : 'ltr'
            " label="نام جدید  "></app-form-text-input>

    </div>

  </section>

  <!-- <section class="preview" *ngIf="storageService.previewPath">
  

  </section> -->

  <section class="preview" [class.active]="!!storageService.previewItem" *ngIf="!storageService.loadingText">


    <img src="assets/graphics/filemanager.svg" class="empty-bg" *ngIf="!storageService.previewItem">
    <ul class="nav en" *ngIf="storageService.previewItem">

      <li [class.active]="imgViewerActive" *ngIf="storageService.previewItem.mime.indexOf('image/') == 0"
        (click)="imgViewerActive = true; codeEditorActive = false;visualEditorActive = false;iframeActive = false">
        Image Viewer
      </li>
      <li [class.active]="iframeActive"
        (click)="imgViewerActive = false; codeEditorActive = false;visualEditorActive = false;iframeActive = true">
        iFrame
      </li>
      <li [class.active]="codeEditorActive" *ngIf="codeEditorVisible"
        (click)="imgViewerActive = false; iframeActive = false; visualEditorActive = false; codeEditorActive = true">
        Code Editor
      </li>

      <li [class.active]="visualEditorActive" *ngIf="visualEditorVisible"
        (click)="imgViewerActive = false; codeEditorActive = false;iframeActive = false; visualEditorActive = true">
        Visual Editor
      </li>
      <li>
        {{storageService.previewItem?.mime}}
      </li>
    </ul>

    <app-iframe *ngIf="iframeActive && storageService.previewPath" [url]="storageService.previewPath"></app-iframe>

    <app-form-code-input [layout]="'full'" *ngIf="codeEditorVisible && codeEditorActive"
      (modelChange)="codeEditorChange($event)" [model]="codeEditorModel" [language]="codeEditorLanguage">
    </app-form-code-input>


    <app-form-quill-input *ngIf="visualEditorActive" [theme]="'bubble'" [model]="codeEditorModel">

    </app-form-quill-input>

    <img [src]="storageService.previewPath" class="preview-image" *ngIf="storageService.previewItem && imgViewerActive">

  </section>


  <div class="clearfix"></div>
</div>
